{"version":3,"file":"react-global-states.umd.js","sources":["../node_modules/@babel/runtime/helpers/extends.js","../src/index.js"],"sourcesContent":["function _extends() {\n  module.exports = _extends = Object.assign || function (target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n\n      for (var key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n          target[key] = source[key];\n        }\n      }\n    }\n\n    return target;\n  };\n\n  return _extends.apply(this, arguments);\n}\n\nmodule.exports = _extends;","import React, { useState, useEffect } from 'react';\n\n// \"The\" global store\nlet store = {};\n\n// internal publisher-subscriber system to\n// notify containers of store changes.\nconst pubsub = {\n  handlers: [],\n  subscribe(handler) {\n    // console.log('subscribed');\n    if (!this.handlers.includes(handler)) {\n      this.handlers.push(handler);\n    }\n  },\n  unsubscribe(handler) {\n    // console.log('unsubscribed');\n    const index = this.handlers.indexOf(handler);\n    if (index > -1) {\n      this.handlers.splice(index, 1);\n    }\n  },\n  notify(newStore) {\n    this.handlers.forEach(handler => handler(newStore));\n  }\n};\n\n// global state merger. unlike redux, I am not enforcing reducer layer\nexport const updateState = (partial) => {\n  const newStore = {\n    ...store,\n    ...partial,\n  };\n  store = newStore;\n  pubsub.notify(newStore);\n};\n\n// curry function to partially update a sub property of global store.\n// e.g const updateCartState = createSubPropUpdater('cart');\n// updateCartState({ items: [], quantity: 0 });\n// this is equivalent to\n// updateState({ cart: { ...store.cart, items: [], quantity: 0 } })\nexport const createSubPropUpdater = (propName) => {\n  return (partial) => {\n    const newStore = {\n      ...store,\n      [propName]: {\n        ...(store[propName] || {}),\n        ...partial,\n      }\n    };\n    store = newStore;\n    pubsub.notify(newStore);\n  };\n};\n\nexport const setState = (newState) => {\n  const newStore = { ...newState };\n  store = newStore;\n  pubsub.notify(newStore);\n};\n\n// utility\nconst plainObjectPrototype = Object.getPrototypeOf({});\nconst twoLevelIsEqual = (oldState, newState, level = 1) => {\n  if (\n    oldState === null\n    || newState === null\n    || oldState === undefined\n    || newState === undefined\n  ) {\n    return oldState === newState;\n  }\n\n  const oldStatePrototype = Object.getPrototypeOf(oldState);\n  if (\n    level <= 2\n    && (oldStatePrototype === plainObjectPrototype || Array.isArray(oldState))\n    && oldStatePrototype === Object.getPrototypeOf(newState)\n  ) {\n    // check if all props of oldState is in newState\n    let isEqual = Object\n      .entries(oldState)\n      .every(([key, val]) => twoLevelIsEqual(val, newState[key], level + 1));\n    // check if all props of newState is in oldState\n    isEqual = isEqual && Object\n      .entries(newState)\n      .every(([key, val]) => twoLevelIsEqual(oldState[key], val, level + 1));\n    // if so, they are equal (upto two levels).\n    return isEqual;\n  }\n  if (oldState instanceof Date && newState instanceof Date) {\n    return oldState.getTime() === newState.getTime();\n  }\n  return oldState === newState;\n};\n\n// used to wrap components to receive global store props\nexport const connect = (propsToConnectTo = [], Component) => {\n  return (props) => { // state container\n    let [state, setState] = useState(\n      propsToConnectTo.reduce((acc, propName) => {\n        if (propName in store) {\n          acc[propName] = store[propName];\n        }\n        return acc;\n      }, {}),\n    );\n\n    useEffect(() => {\n      const newStateHandler = (newStore) => {\n        const newState = propsToConnectTo.reduce((acc, propName) => {\n          if (propName in store) {\n            acc[propName] = newStore[propName];\n          }\n          return acc;\n        }, {});\n        // console.log('current state', state);\n        // console.log('new state', newState);\n        // console.log('twoLevelIsEqual', twoLevelIsEqual(state, newState));\n        if (!twoLevelIsEqual(state, newState)) {\n          setState(newState);\n        }\n      };\n      pubsub.subscribe(newStateHandler);\n      // on component unmount, unsubscribe to prevent mem leak\n      return () => pubsub.unsubscribe(newStateHandler);\n    }, [state]);\n\n    return <Component {...state} {...props} />;\n  };\n}"],"names":["store","pubsub","handlers","subscribe","handler","includes","push","unsubscribe","index","indexOf","splice","notify","newStore","forEach","updateState","partial","createSubPropUpdater","propName","setState","newState","plainObjectPrototype","Object","getPrototypeOf","twoLevelIsEqual","oldState","level","undefined","oldStatePrototype","Array","isArray","isEqual","entries","every","key","val","Date","getTime","connect","propsToConnectTo","Component","props","useState","reduce","acc","state","useEffect","newStateHandler","React"],"mappings":"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"}